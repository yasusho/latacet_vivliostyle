{"version":3,"sources":["../src/core/init.ts"],"sourcesContent":["import fs from 'node:fs';\nimport upath from 'upath';\nimport { cyan, yellow } from 'yoctocolors';\nimport { ParsedVivliostyleInlineConfig } from '../config/schema.js';\nimport { cliVersion, CONTAINER_URL } from '../const.js';\nimport { Logger } from '../logger.js';\nimport { cwd, runExitHandlers } from '../util.js';\n\nexport async function init(inlineConfig: ParsedVivliostyleInlineConfig) {\n  Logger.setLogLevel(inlineConfig.logLevel);\n  Logger.setCustomLogger(inlineConfig.logger);\n\n  const vivliostyleConfigPath = upath.join(\n    inlineConfig.cwd ?? cwd,\n    'vivliostyle.config.js',\n  );\n\n  if (fs.existsSync(vivliostyleConfigPath)) {\n    runExitHandlers();\n    return Logger.log(\n      `${yellow('vivliostyle.config.js already exists. aborting.')}`,\n    );\n  }\n\n  // prettier-ignore\n  const vivliostyleConfig = `// @ts-check\n/** @type {import('@vivliostyle/cli').VivliostyleConfigSchema} */\nconst vivliostyleConfig = {\n  title: '${ inlineConfig.title || 'Principia'}', // populated into 'publication.json', default to 'title' of the first entry or 'name' in 'package.json'.\n  author: '${inlineConfig.author || 'Isaac Newton'}', // default to 'author' in 'package.json' or undefined\n  ${inlineConfig.language ? '' : '// '}language: '${inlineConfig.language || 'la'}',\n  // readingProgression: 'rtl', // reading progression direction, 'ltr' or 'rtl'.\n  ${inlineConfig.size ? '' : '// '}size: '${inlineConfig.size || 'A4'}',\n  ${inlineConfig.theme ? '' : '// '}theme: '${inlineConfig.theme?.[0].specifier || ''}', // .css or local dir or npm package. default to undefined\n  image: '${CONTAINER_URL}:${cliVersion}',\n  entry: [ // **required field**\n    // 'introduction.md', // 'title' is automatically guessed from the file (frontmatter > first heading)\n    // {\n    //   path: 'epigraph.md',\n    //   title: 'おわりに', // title can be overwritten (entry > file),\n    //   theme: '@vivliostyle/theme-whatever' // theme can be set individually. default to root 'theme'\n    // },\n    // 'glossary.html' // html is also acceptable\n  ], // 'entry' can be 'string' or 'object' if there's only single markdown file\n  // entryContext: './manuscripts', // default to '.' (relative to 'vivliostyle.config.js')\n  // output: [ // path to generate draft file(s). default to '{title}.pdf'\n  //   './output.pdf', // the output format will be inferred from the name.\n  //   {\n  //     path: './book',\n  //     format: 'webpub',\n  //   },\n  // ],\n  // workspaceDir: '.vivliostyle', // directory which is saved intermediate files.\n  // toc: {\n  //   title: 'Table of Contents',\n  //   htmlPath: 'index.html',\n  //   sectionDepth: 3,\n  // },\n  // cover: './cover.png', // cover image. default to undefined.\n  // vfm: { // options of VFM processor\n  //   replace: [ // specify replace handlers to modify HTML outputs\n  //     {\n  //       // This handler replaces {current_time} to a current local time tag.\n  //       test: /{current_time}/,\n  //       match: (_, h) => {\n  //         const currentTime = new Date().toLocaleString();\n  //         return h('time', { datetime: currentTime }, currentTime);\n  //       },\n  //     },\n  //   ],\n  //   hardLineBreaks: true, // converts line breaks of VFM to <br> tags. default to 'false'.\n  //   disableFormatHtml: true, // disables HTML formatting. default to 'false'.\n  // },\n};\n\nmodule.exports = vivliostyleConfig;\n`;\n\n  fs.mkdirSync(upath.dirname(vivliostyleConfigPath), { recursive: true });\n  fs.writeFileSync(vivliostyleConfigPath, vivliostyleConfig);\n\n  runExitHandlers();\n  Logger.log(`Successfully created ${cyan('vivliostyle.config.js')}`);\n}\n"],"mappings":";;;;;;;;;;;AAAA,OAAO,QAAQ;AACf,OAAO,WAAW;AAClB,SAAS,MAAM,cAAc;AAM7B,eAAsB,KAAK,cAA6C;AACtE,SAAO,YAAY,aAAa,QAAQ;AACxC,SAAO,gBAAgB,aAAa,MAAM;AAE1C,QAAM,wBAAwB,MAAM;AAAA,IAClC,aAAa,OAAO;AAAA,IACpB;AAAA,EACF;AAEA,MAAI,GAAG,WAAW,qBAAqB,GAAG;AACxC,oBAAgB;AAChB,WAAO,OAAO;AAAA,MACZ,GAAG,OAAO,iDAAiD,CAAC;AAAA,IAC9D;AAAA,EACF;AAGA,QAAM,oBAAoB;AAAA;AAAA;AAAA,YAGf,aAAa,SAAS,WAAW;AAAA,aACjC,aAAa,UAAU,cAAc;AAAA,IAC9C,aAAa,WAAW,KAAK,KAAK,cAAc,aAAa,YAAY,IAAI;AAAA;AAAA,IAE7E,aAAa,OAAO,KAAK,KAAK,UAAU,aAAa,QAAQ,IAAI;AAAA,IACjE,aAAa,QAAQ,KAAK,KAAK,WAAW,aAAa,QAAQ,CAAC,EAAE,aAAa,EAAE;AAAA,YACzE,aAAa,IAAI,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4CrC,KAAG,UAAU,MAAM,QAAQ,qBAAqB,GAAG,EAAE,WAAW,KAAK,CAAC;AACtE,KAAG,cAAc,uBAAuB,iBAAiB;AAEzD,kBAAgB;AAChB,SAAO,IAAI,wBAAwB,KAAK,uBAAuB,CAAC,EAAE;AACpE;","names":[]}