{"version":3,"sources":["../src/vite-adapter.ts"],"sourcesContent":["import * as v from 'valibot';\nimport * as vite from 'vite';\nimport { setupConfigFromFlags } from './commands/cli-flags.js';\nimport { loadVivliostyleConfig, warnDeprecatedConfig } from './config/load.js';\nimport { mergeInlineConfig } from './config/merge.js';\nimport { resolveTaskConfig } from './config/resolve.js';\nimport { VivliostyleInlineConfig } from './config/schema.js';\nimport { Logger } from './logger.js';\nimport { vsBrowserPlugin } from './vite/vite-plugin-browser.js';\nimport { vsDevServerPlugin } from './vite/vite-plugin-dev-server.js';\nimport { vsStaticServePlugin } from './vite/vite-plugin-static-serve.js';\nimport { vsViewerPlugin } from './vite/vite-plugin-viewer.js';\n\nexport async function createVitePlugin(\n  inlineConfig: VivliostyleInlineConfig = {},\n): Promise<vite.Plugin[]> {\n  const parsedInlineConfig = v.parse(VivliostyleInlineConfig, inlineConfig);\n  Logger.setLogLevel(parsedInlineConfig.logLevel);\n  if (parsedInlineConfig.logger) {\n    Logger.setCustomLogger(parsedInlineConfig.logger);\n  } else {\n    const { info, warn, error } = vite.createLogger('info', {\n      prefix: '[vivliostyle]',\n    });\n    Logger.setCustomLogger({\n      info: (msg) => info(msg, { timestamp: true }),\n      warn: (msg) => warn(msg, { timestamp: true }),\n      error: (msg) => error(msg, { timestamp: true }),\n    });\n  }\n  Logger.debug('inlineConfig %O', parsedInlineConfig);\n  const vivliostyleConfig =\n    (await loadVivliostyleConfig(parsedInlineConfig)) ??\n    setupConfigFromFlags(parsedInlineConfig);\n  warnDeprecatedConfig(vivliostyleConfig);\n  const { tasks, inlineOptions } = mergeInlineConfig(\n    vivliostyleConfig,\n    parsedInlineConfig,\n  );\n  const config = resolveTaskConfig(tasks[0], inlineOptions);\n  Logger.debug('config %O', config);\n\n  return [\n    vsDevServerPlugin({ config, inlineConfig: parsedInlineConfig }),\n    vsViewerPlugin({ config, inlineConfig: parsedInlineConfig }),\n    vsBrowserPlugin({ config, inlineConfig: parsedInlineConfig }),\n    vsStaticServePlugin({ config, inlineConfig: parsedInlineConfig }),\n  ];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,YAAY,OAAO;AACnB,YAAY,UAAU;AAYtB,eAAsB,iBACpB,eAAwC,CAAC,GACjB;AACxB,QAAM,qBAAuB,QAAM,yBAAyB,YAAY;AACxE,SAAO,YAAY,mBAAmB,QAAQ;AAC9C,MAAI,mBAAmB,QAAQ;AAC7B,WAAO,gBAAgB,mBAAmB,MAAM;AAAA,EAClD,OAAO;AACL,UAAM,EAAE,MAAM,MAAM,MAAM,IAAS,kBAAa,QAAQ;AAAA,MACtD,QAAQ;AAAA,IACV,CAAC;AACD,WAAO,gBAAgB;AAAA,MACrB,MAAM,CAAC,QAAQ,KAAK,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,MAC5C,MAAM,CAAC,QAAQ,KAAK,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,MAC5C,OAAO,CAAC,QAAQ,MAAM,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,IAChD,CAAC;AAAA,EACH;AACA,SAAO,MAAM,mBAAmB,kBAAkB;AAClD,QAAM,oBACH,MAAM,sBAAsB,kBAAkB,KAC/C,qBAAqB,kBAAkB;AACzC,uBAAqB,iBAAiB;AACtC,QAAM,EAAE,OAAO,cAAc,IAAI;AAAA,IAC/B;AAAA,IACA;AAAA,EACF;AACA,QAAM,SAAS,kBAAkB,MAAM,CAAC,GAAG,aAAa;AACxD,SAAO,MAAM,aAAa,MAAM;AAEhC,SAAO;AAAA,IACL,kBAAkB,EAAE,QAAQ,cAAc,mBAAmB,CAAC;AAAA,IAC9D,eAAe,EAAE,QAAQ,cAAc,mBAAmB,CAAC;AAAA,IAC3D,gBAAgB,EAAE,QAAQ,cAAc,mBAAmB,CAAC;AAAA,IAC5D,oBAAoB,EAAE,QAAQ,cAAc,mBAAmB,CAAC;AAAA,EAClE;AACF;","names":[]}